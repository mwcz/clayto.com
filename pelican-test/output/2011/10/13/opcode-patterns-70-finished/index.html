<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>mwcz.org - a blog</title>
    <meta name="description" content="">
    <meta name="author" content="mwcz">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://localhost:8000/theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="http://localhost:8000/theme/bootstrap.min.css" rel="stylesheet">
    <link href="http://localhost:8000/theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="http://localhost:8000/theme/local.css" rel="stylesheet">
    <link href="http://localhost:8000/theme/pygments.css" rel="stylesheet">

</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
    <div class="container">

         <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
         </a>

        <a class="brand" href="http://localhost:8000">mwcz.org - a blog</a>

        <div class="nav-collapse">
        <ul class="nav">
                    
                                </ul>
        </div>
        
    </div>
    </div>
</div>

<div class="container">
    <div class="content">
    <div class="row">

        <div class="span9">
            <div class='article'>
        <div class="content-title">
            <h1>Opcode patterns 70% finished</h1>
            Thu 13 October 2011

by <a class="url fn" href="http://localhost:8000/author/mwcz.html">mwcz</a>
 


        </div>
	
        <div><p>genlut.py is really filling out.  It generates the LUT for all 68k opcodes (68000 only), and I'm about 70% done.  77 down, 34 to go.</p>
<p>The OPCODES dict defines the first two bytes of each opcode, both static bits and operands.  The operand strings act as keys into the PATTERNS struct, which contains all possible values for each operand.</p>
<p>The recursive function gen() is fed an opcode pattern which may contain operand strings as well as static bits.  Some operand patterns contain other operand patterns, so gen() keeps recursing until all operand patterns are gone.  Once a set of totally static bits has been created, those bits are added to INSTRUCTIONS, along with the name of the opcode.</p>
<p>The PATTERNS, OPCODES, and INSTRUCTIONS dicts are all named poorly, and the whole solution  isn't ultra-elegant, but it does follow the structure of the 68k PRM pretty intuitively and is easy to edit.  Once it's complete, I should never need to run it again.</p>
<p>(This post was copied from my old <a href="http://aejs.blogspot.com/">AEJS blog</a>)</p></div>
	
        <hr>
    	   
        <h2>Comments</h2>
		<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'mwcz'; 
    var disqus_title = 'Opcode patterns 70% finished';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
        </div>
        
        <div class="span3">

            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Site
                </li>
            
                <li><a href="http://localhost:8000/">Archives</a>
                <li><a href="http://localhost:8000/tags.html">Tags</a>
                <li><a href="http://localhost/" rel="alternate">Atom feed</a></li>
                            </ul>
            </div>


                        <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Categories
                </li>
                
                                <li><a href="http://localhost:8000/category/misc.html">misc</a></li>
                                   
            </ul>
            </div>
            

            

                        <div class="social">
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Social
                </li>
           
                                <li><a href="https://github.com/mwcz">GitHub</a></li>
                                <li><a href="https://twitter.com/mwcz">Twitter</a></li>
                            </ul>
            </div>
            </div>
            
        </div>  
    </div>     </div> 
<footer>
<br />
<p><a href="http://localhost:8000">mwcz.org - a blog</a> &copy; mwcz 2012</p>
</footer>

</div> <!-- /container -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-collapse.js"></script>
<a href="https://github.com/mwcz"><img style="position: absolute; top: 40px; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png" alt="Fork me on GitHub" /></a>
 
</body>
</html>