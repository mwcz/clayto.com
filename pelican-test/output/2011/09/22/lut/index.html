<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>mwcz.org - a blog</title>
    <meta name="description" content="">
    <meta name="author" content="mwcz">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://localhost:8000/theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="http://localhost:8000/theme/bootstrap.min.css" rel="stylesheet">
    <link href="http://localhost:8000/theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="http://localhost:8000/theme/local.css" rel="stylesheet">
    <link href="http://localhost:8000/theme/pygments.css" rel="stylesheet">

</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
    <div class="container">

         <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
         </a>

        <a class="brand" href="http://localhost:8000">mwcz.org - a blog</a>

        <div class="nav-collapse">
        <ul class="nav">
                    
                                </ul>
        </div>
        
    </div>
    </div>
</div>

<div class="container">
    <div class="content">
    <div class="row">

        <div class="span9">
            <div class='article'>
        <div class="content-title">
            <h1>LUT</h1>
            Thu 22 September 2011

by <a class="url fn" href="http://localhost:8000/author/mwcz.html">mwcz</a>
 


        </div>
	
        <div><p>Decoding is easy. Decoding requires a lot of typing. (I am starting to believe this is true of ever aspect of interpreted emulation...)</p>
<p>For the AEJS decoder, I am creating a <a href="http://en.wikipedia.org/wiki/Lookup_table">look-up table</a> with every possible pattern for each instruction. It was my first idea, but I initially discarded it as "wasteful and inelegant". Later, I accepted it as "really fast".</p>
<p>I'm generating a large set of bit patterns that map to 68k opcodes, like so:</p>
<div class="highlight"><pre><span class="mo">0100101011111010</span> <span class="o">-&gt;</span> <span class="n">BGND</span>
<span class="mo">0100101011111100</span> <span class="o">-&gt;</span> <span class="n">ILLEGAL</span>
<span class="mo">0100111001110000</span> <span class="o">-&gt;</span> <span class="n">RESET</span>
<span class="mo">0100111001110001</span> <span class="o">-&gt;</span> <span class="n">NOP</span>
<span class="mo">0100111001110010</span> <span class="o">-&gt;</span> <span class="n">STOP</span>
<span class="mo">0100111001110011</span> <span class="o">-&gt;</span> <span class="n">RTE</span>
</pre></div>


<p>The current code can be found <a href="https://github.com/mwcz/AEJS/blob/master/src/genlut.py">here</a>.</p>
<p>Yes, it's written in Python and yes, AEJS is a JavaScript project.  There's a reason.  I see two approaches to generating the LUT (look-up table).</p>
<h2>Generate the LUT on launch (dynamic)</h2>
<p>This has the advantage of being easier to debug.  It also might be easier if I ever expand the emulator to other chips, like the <a href="http://en.wikipedia.org/wiki/Motorola_68020">68020</a> or <a href="http://en.wikipedia.org/wiki/Motorola_68030">68030</a>.</p>
<p>It currently takes about 0.466 seconds on my machine to generate ~12,000 patterns.  That means it should take less than 2.5s to generate the full LUT.</p>
<h2>Generate the LUT pre-launch (static)</h2>
<p>This is what I'm currently working toward.  genlut.py is currently generating about 12,000 opcode bit patterns out of a max of I'm-not-sure-yet-but-slightly-less-than-65,536.</p>
<p>With this method, I would run genlut.py one final time, pipe the output into a static JS file, and regex the contents into a JS array.  The LUT would never have to be generated again, and would exist happily forever-after.</p>
<p>Cons: relies upon the LUT being 100% correct, as any errors would be hard to debug, and would require another run of genlut.py to fix.</p>
<p>Pros: AEJS will launch faster without having to generate the LUT each time.  If I can verify that the LUT is 100% correct, this is obviously the right approach.</p>
<p>I'll continue on with the static method for now, and odds are I'll stick with it.   2.5s is too big a price to pay.</p>
<p>Back to work:</p>
<p><a href="/img/013/workarea.png"><img class="grid_7" src="/img/013/workarea.png" alt=":)" title="" /></a>
<div class="clear"></div></p>
<p>(This post was copied from my old <a href="http://aejs.blogspot.com/">AEJS blog</a>)</p></div>
	
        <hr>
    	   
        <h2>Comments</h2>
		<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'mwcz'; 
    var disqus_title = 'LUT';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
        </div>
        
        <div class="span3">

            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Site
                </li>
            
                <li><a href="http://localhost:8000/">Archives</a>
                <li><a href="http://localhost:8000/tags.html">Tags</a>
                <li><a href="http://localhost/" rel="alternate">Atom feed</a></li>
                            </ul>
            </div>


                        <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Categories
                </li>
                
                                <li><a href="http://localhost:8000/category/misc.html">misc</a></li>
                                   
            </ul>
            </div>
            

            

                        <div class="social">
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Social
                </li>
           
                                <li><a href="https://github.com/mwcz">GitHub</a></li>
                                <li><a href="https://twitter.com/mwcz">Twitter</a></li>
                            </ul>
            </div>
            </div>
            
        </div>  
    </div>     </div> 
<footer>
<br />
<p><a href="http://localhost:8000">mwcz.org - a blog</a> &copy; mwcz 2012</p>
</footer>

</div> <!-- /container -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-collapse.js"></script>
<a href="https://github.com/mwcz"><img style="position: absolute; top: 40px; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png" alt="Fork me on GitHub" /></a>
 
</body>
</html>