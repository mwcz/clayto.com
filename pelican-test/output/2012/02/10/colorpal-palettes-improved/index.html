<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>mwcz.org - a blog</title>
    <meta name="description" content="">
    <meta name="author" content="mwcz">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://localhost:8000/theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="http://localhost:8000/theme/bootstrap.min.css" rel="stylesheet">
    <link href="http://localhost:8000/theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="http://localhost:8000/theme/local.css" rel="stylesheet">
    <link href="http://localhost:8000/theme/pygments.css" rel="stylesheet">

</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
    <div class="container">

         <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
         </a>

        <a class="brand" href="http://localhost:8000">mwcz.org - a blog</a>

        <div class="nav-collapse">
        <ul class="nav">
                    
                                </ul>
        </div>
        
    </div>
    </div>
</div>

<div class="container">
    <div class="content">
    <div class="row">

        <div class="span9">
            <div class='article'>
        <div class="content-title">
            <h1>ColorPal palettes improved!</h1>
            Fri 10 February 2012

by <a class="url fn" href="http://localhost:8000/author/mwcz.html">mwcz</a>
 


        </div>
	
        <div><p><a href="/projects/colorpal"><img src="/img/019/colorpal_logo.png" alt="ColorPal logo" title=""
/></a></p>
<p>In my <a href="/2012/01/16/colorpal-alpha/">last post</a> on the subject, I introduced
ColorPal, my HTML5 color palette generation tool.  It didn't perform well with
certain types of images, so I fixed it. :)</p>
<p>Color palettes will now match the image even better.  Especially for images
with infrequent but <em>important</em> colors.  Here's a comparison of the old and new
methods, on an image that is mostly black:</p>
<p><img alt="comparison of palettes generated with median and
mean" src="/img/019/median-mean-comparison.png" /></p>
<p>You can see that with the old method, the black pixels definitely took over the
palette.</p>
<p><a href="/projects/colorpal">Try it with your own images!</a></p>
<p>For some images, this change won't affect palettes at all.  But for images with
low-population, high-importance colors, like the one above, palettes will look
<em>much</em> better!</p>
<p>Technical discussion below.</p>
<h1>Why the 'median' in median-cut?</h1>
<p>Median Cut is an algorithm typically used to reduce the number of colors in an
image.</p>
<p><img alt="16 million colors versus 16 colors" src="/img/019/median-cut-example.png" /></p>
<p>The steps to perform median cut are fairly straightforward:</p>
<ol>
<li>
<p>Find the smallest box which contains all the colors.</p>
</li>
<li>
<p>Sort the enclosed colors along the longest axis of the box.</p>
</li>
<li>
<p>Split the box into two regions at median of the sorted list.</p>
</li>
<li>
<p>Repeat the above process until the original color space has been divided
     into N regions where N is the number of colors you want.</p>
</li>
</ol>
<p>Not too bad, right?  The question remains, though, why median?</p>
<p>Mean, median, and mode all attempt to measure the
<a href="http://en.wikipedia.org/wiki/Location_parameter">location</a> of a probability
distribution.  Worded more intuitively... they try to find the center of a set
of numbers.  They just employ different definitions of "center".</p>
<p><img alt="mean, median, and mode graphed" src="/img/019/mean_median_mode.png" />
(Thanks <a href="http://en.wikipedia.org/wiki/Median">Wikipedia</a>)</p>
<p>As you can see clearly in the dashed data set, the mean tends to follow the
tail.  In other words, mean is useful when outliers are important.  When
generating a color palette, outliers are essential.  Outliers may be the small
streak of color in an otherwise drab sky, or a small red rose in the middle of
a green field.</p>
<p>The goal of median cut is <em>not</em> to generate a color palette.  It's to
efficiently reduce the number of colors in an image.  Since my goal with
ColorPal is to find good-lookin' colors, I've modified the algorithm to split
boxes at the <strong>mean</strong> instead of the <strong>median</strong>.  Mean splits boxes closer to
the outliers, which keeps low-population colors nicely segregated from the
high-population colors.</p>
<p>Thus step 3 becomes:</p>
<div class="pygments_murphy syntax_highlight">
  3. Split the box into two regions at the <b>mean</b> of the sorted list.
</div>

<p>The result?  Mean Cut!  Also: awesome color palettes.</p>
<h2>Interesting side-note on color distributions</h2>
<p>Interestingly, photographs of nature tend to have nice, close-to-normal color
distributions.  A "normal distribution" is a formal term for a "bell curve".</p>
<p>Check out the red, green, and blue distributions for a photograph of a forest.</p>
<p><img alt="Forest red   pixel distribution" src="/img/019/forest_r.png" />
<img alt="Forest green pixel distribution" src="/img/019/forest_g.png" />
<img alt="Forest blue  pixel distribution" src="/img/019/forest_b.png" /></p>
<p>For comparison, here are the distributions for a shot of NYC.</p>
<p><img alt="City   red   pixel distribution" src="/img/019/city_r.png" />
<img alt="City   green pixel distribution" src="/img/019/city_g.png" />
<img alt="City   blue  pixel distribution" src="/img/019/city_b.png" /></p>
<h2>What's next for ColorPal?  Color spaces.</h2>
<p>Mean-cut improves ColorPal dramatically for some images, but it's still not
perfect.  Perfection probably won't be attainable, but there are still many
ways to improve.</p>
<p>My next test will be converting to a color space other than RGB.</p>
<p>HSL is common, and the RGB/HSL conversion formulas are in my very old JSImage
project.  It may not turn out well, though, as the concept of "widest box"
loses most of its meaning when each axis is a completely different unit of
measure.  Although, in a way, I suppose RGB has a similar problem.  Red, Green,
and Blue could be thought of as unrelated units.  I'll try it out and see how
it goes.  I wonder if my old JavaScript RGB/HSL code has rotted away yet...</p>
<p>Most likely, I'll skip HSL and try one of the
<a href="http://en.wikipedia.org/wiki/Lab_color_space">Lab</a> color spaces first, since
they are not composed linear values like RGB and HSL.  Instead, Lab color
spaces use non-linear scales that closely match human perception of color.
Perfect for my purposes.  How fortuitious for me that CIE invented it way back
in 1931.</p>
<p>There are three "Lab" color spaces: XYZ, Hunter-Lab,
and CIELAB.  XYZ will be first to the plate, since the RGB/XYZ formulas are
the simplest.  Let me take this opportune moment to plug
<a href="http://www.easyrgb.com/index.php?X=MATH">EasyRGB.com</a>.</p>
<h2>Lend a hand</h2>
<p>As I've mentioned before, ColorPal is in an early stage of development.  It
needs testing in multiple browsers, and I'm very interested in hearing people's
feedback.  Code development help is welcomed too.</p>
<p>If you try out ColorPal, shoot me an <a href="mailto:mwc@clayto.org">email</a>
or give me a shout on <a href="https://twitter.com/#!/mwcz">Twitter</a> with your
thoughts.  Thanks!</p>
<p>Here are github repos for <a href="https://github.com/mwcz/ColorPal">ColorPal</a> and
<a href="https://github.com/mwcz/median-cut-js">median-cut.js</a>.</p></div>
	
        <hr>
    	   
        <h2>Comments</h2>
		<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'mwcz'; 
    var disqus_title = 'ColorPal palettes improved!';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
        </div>
        
        <div class="span3">

            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Site
                </li>
            
                <li><a href="http://localhost:8000/">Archives</a>
                <li><a href="http://localhost:8000/tags.html">Tags</a>
                <li><a href="http://localhost/" rel="alternate">Atom feed</a></li>
                            </ul>
            </div>


                        <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Categories
                </li>
                
                                <li><a href="http://localhost:8000/category/misc.html">misc</a></li>
                                   
            </ul>
            </div>
            

            

                        <div class="social">
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Social
                </li>
           
                                <li><a href="https://github.com/mwcz">GitHub</a></li>
                                <li><a href="https://twitter.com/mwcz">Twitter</a></li>
                            </ul>
            </div>
            </div>
            
        </div>  
    </div>     </div> 
<footer>
<br />
<p><a href="http://localhost:8000">mwcz.org - a blog</a> &copy; mwcz 2012</p>
</footer>

</div> <!-- /container -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="http://twitter.github.com/bootstrap/assets/js/bootstrap-collapse.js"></script>
<a href="https://github.com/mwcz"><img style="position: absolute; top: 40px; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png" alt="Fork me on GitHub" /></a>
 
</body>
</html>