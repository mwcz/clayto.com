!function(){"use strict";window.clayto=angular.module("clayto",["ngRoute","ngTouch","ngAnimate","clayto.services","clayto.controllers"]).config(function($routeProvider,$httpProvider){$routeProvider.when("/",{templateUrl:"partials/photo.html",controller:"PhotoGalleryCtrl"}),$routeProvider.when("/photo/:photoId",{templateUrl:"partials/photo.html",controller:"PhotoCtrl"}),$routeProvider.otherwise({redirectTo:"/"}),$httpProvider.defaults.cache=!0})}(),function(){"use strict";var claytoServices=angular.module("clayto.services",["ngResource"]),flickr_clayto_photoset="http://api.flickr.com/services/rest/?method=flickr.photosets.getPhotos&api_key=522454d4d32900b5b28dae598daab260&photoset_id=72157639704760704&format=json&nojsoncallback=1";claytoServices.factory("Photoset",function($resource){return $resource(flickr_clayto_photoset,{},{})}),claytoServices.factory("Palette",function($resource,$http){var return_data,palette_request=$http.get("palettes.json");return palette_request.success(function(data){return_data=data}),palette_request.error(function(data){return_data=data}),$resource("palettes.json")})}(),function(){"use strict";function flickr_get_image_url(photo,size){return"http://farm"+photo.farm+".staticflickr.com/"+photo.server+"/"+photo.id+"_"+photo.secret+flickr_get_image_url.SIZES[size]+".jpg"}function pre_cache(image){image.img=image.lazy_img}function pre_cache_adjacent(scope,count){var i,current;for(i=-count;count>=i;i+=1)current=scope.current_photo+i,current>=0&&current<scope.photos.length&&pre_cache(scope.photos[scope.current_photo+i])}var claytoControllers=angular.module("clayto.controllers",[]);flickr_get_image_url.SIZES={75:"_s",150:"_q",100:"_t",240:"_m",320:"_n",500:"",640:"_z",800:"_c",940:"_b",original:"_o"},claytoControllers.controller("PhotoGalleryCtrl",function($scope,$timeout,$interval,Photoset,Palette){$scope.photos=[],$scope.current_photo=0,$scope.prev=function(){current_photo-=1},$scope.next=function(){current_photo+=1},Photoset.get({},function(photoset){var photos,i,redirect_delay,redirect_tick;if("fail"===photoset.stat)redirect_delay=5e3,redirect_tick=1e3,i=0,$scope.flickr_fail=!0,NProgress.configure({showSpinner:!1}),NProgress.start(),$interval(function(){i+=1,NProgress.set(i/(redirect_delay/redirect_tick))},redirect_tick),$timeout(function(){window.location="http://www.flickr.com/mwcloud"},redirect_delay);else{for(photos=photoset.photoset.photo,i=0,i=0;i<photos.length;i+=1)$scope.photos.push({title:photos[i].title,lazy_img:flickr_get_image_url(photos[i],940),img:"",palette:[[39,36,37],[255,255,255],[254,254,254]]});$scope.$watch("current_photo",function(new_index,old_index,scope){var over=scope.current_photo>=scope.photos.length,under=scope.current_photo<0,cache_adjacent=2;Palette.get({},function(palettes){var bg,border;try{bg=palettes[photos[scope.current_photo].title].background,border=palettes[photos[scope.current_photo].title].border}catch(e){bg="#000",border="#999"}document.body.style.backgroundColor=bg}),pre_cache_adjacent(scope,cache_adjacent),under?scope.current_photo=0:over&&(scope.current_photo=scope.photos.length-1)})}})})}(),function(){"use strict"}(),function(){"use strict";clayto.directive("keyLeft",function(){return function(scope,element,attrs){element.bind("keydown keypress",function(event){37===event.which&&(scope.$apply(function(){scope.$eval(attrs.keyLeft)}),event.preventDefault())})}}),clayto.directive("keyRight",function(){return function(scope,element,attrs){element.bind("keydown keypress",function(event){39===event.which&&(scope.$apply(function(){scope.$eval(attrs.keyRight)}),event.preventDefault())})}})}(),function(){"use strict";clayto.animation(".photo-slide",function(){var next=1,prev=-1;return{beforeAddClass:function(element,className,done){var scope=angular.element(element).scope(),lee=scope.current_photo-scope.$index;lee===next?element.addClass("slide-left"):lee===prev&&element.addClass("slide-right"),done()},beforeRemoveClass:function(element,className,done){element.removeClass("slide-left"),element.removeClass("slide-right"),done()}}})}();